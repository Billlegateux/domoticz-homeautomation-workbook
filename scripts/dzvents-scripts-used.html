<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Domoticz dzVents Scripts</title></head>

<body>

<H1>Domoticz dzVents Scripts</H1><HR>

<H3>alertmsg_reset</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;alertmsg_reset.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;"Alert&nbsp;Meldung&nbsp;Reset"&nbsp;switch&nbsp;is&nbsp;turned&nbsp;ON,&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;alert&nbsp;sensor&nbsp;(idx=55)&nbsp;is&nbsp;set&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;User&nbsp;Variable&nbsp;DEF_ALERTMSG&nbsp;and&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;switch&nbsp;is&nbsp;turned&nbsp;OFF&nbsp;again.&nbsp;&nbsp;&nbsp;&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Timer<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20180909<BR/>]]--<BR/><BR/>--&nbsp;External&nbsp;modules:<BR/>local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/>&nbsp;<BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices&nbsp;used<BR/>--&nbsp;Switch&nbsp;Alert&nbsp;Meldung&nbsp;Reset<BR/>local&nbsp;IDX_ALERTMSG_RESET&nbsp;=&nbsp;119<BR/><BR/>return&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Check&nbsp;which&nbsp;device(s)&nbsp;have&nbsp;a&nbsp;state&nbsp;change<BR/>	on&nbsp;=&nbsp;{<BR/>		devices&nbsp;=&nbsp;{<BR/>			IDX_ALERTMSG_RESET<BR/>		}<BR/>	},<BR/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Handle&nbsp;the&nbsp;switch&nbsp;if&nbsp;its&nbsp;state&nbsp;has&nbsp;changed&nbsp;to&nbsp;On<BR/>	execute&nbsp;=&nbsp;function(domoticz,&nbsp;device)<BR/>		domoticz.log('Device&nbsp;'&nbsp;..&nbsp;device.name&nbsp;..&nbsp;'&nbsp;was&nbsp;changed&nbsp;'&nbsp;..&nbsp;domoticz.devices(domoticz.variables('IDX_ALERTMSG').value).text,&nbsp;domoticz.LOG_INFO)<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.state&nbsp;==&nbsp;'On')&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;only&nbsp;change&nbsp;if&nbsp;the&nbsp;current&nbsp;text&nbsp;differs&nbsp;from&nbsp;the&nbsp;default&nbsp;text<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(domoticz.devices(domoticz.variables('IDX_ALERTMSG').value).text&nbsp;~=&nbsp;domoticz.variables('DEF_ALERTMSG').value)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;message&nbsp;=&nbsp;domoticz.variables('DEF_ALERTMSG').value<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_GREY,&nbsp;message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log(message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.switchOff()<BR/>		end<BR/>	end<BR/>}<BR/></CODE><HR>
<H3>astro_info</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;astro_info.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Display&nbsp;the&nbsp;sunrise&nbsp;and&nbsp;sunset&nbsp;time&nbsp;plus&nbsp;daylength&nbsp;in&nbsp;a&nbsp;virtual&nbsp;text&nbsp;sensor.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Updated&nbsp;once&nbsp;a&nbsp;day.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Timer<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20181001<BR/>]]--<BR/><BR/>local&nbsp;utils&nbsp;=&nbsp;require('utils')<BR/>--&nbsp;local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/><BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_SUNRISESET&nbsp;=&nbsp;121<BR/><BR/>return&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;active&nbsp;=&nbsp;true,<BR/>&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;'every&nbsp;minute'<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'at&nbsp;01:00'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR/>&nbsp;&nbsp;&nbsp;&nbsp;},<BR/>&nbsp;&nbsp;&nbsp;&nbsp;execute&nbsp;=&nbsp;function(domoticz,&nbsp;timer)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;daylength&nbsp;=&nbsp;domoticz.time.sunsetInMinutes&nbsp;-&nbsp;domoticz.time.sunriseInMinutes<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;msg&nbsp;=&nbsp;utils.MinutesToClock(domoticz.time.sunriseInMinutes)..'&nbsp;-&nbsp;'..utils.MinutesToClock(domoticz.time.sunsetInMinutes)..'&nbsp;('..utils.MinutesToClock(daylength)..')'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(IDX_SUNRISESET).updateText(msg)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log(msg)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>}<BR/><BR/><BR/></CODE><HR>
<H3>coffee_machine_monitor</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;coffee_machine_monitor.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Monitors&nbsp;the&nbsp;electric&nbsp;usage&nbsp;between&nbsp;07:00-08:30.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;>&nbsp;1500&nbsp;(Threshold)&nbsp;then&nbsp;the&nbsp;cofee&nbsp;machine&nbsp;is&nbsp;turned&nbsp;oh.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;machine&nbsp;stays&nbsp;on&nbsp;for&nbsp;2&nbsp;hours,&nbsp;then&nbsp;switches&nbsp;off.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;the&nbsp;alert&nbsp;message&nbsp;with&nbsp;switch&nbsp;off&nbsp;time.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Timer<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20180926<BR/>]]--<BR/><BR/>--&nbsp;Module&nbsp;msgbox:&nbsp;/home/pi/domoticz/scripts/dzVents/scripts<BR/>local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/><BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_STROMVERBRAUCH&nbsp;=&nbsp;44<BR/>local&nbsp;TH_STROMVERBRAUCH&nbsp;=&nbsp;1100<BR/><BR/>local&nbsp;MONITOR_START_END&nbsp;=&nbsp;'at&nbsp;07:00-09:00'<BR/><BR/>return&nbsp;{<BR/>	on&nbsp;=&nbsp;{<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;MONITOR_START_END<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;},<BR/>	},<BR/>	data&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notified&nbsp;=&nbsp;{&nbsp;initial&nbsp;=&nbsp;0&nbsp;}<BR/>&nbsp;&nbsp;&nbsp;&nbsp;},<BR/>	execute&nbsp;=&nbsp;function(domoticz)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Check&nbsp;if&nbsp;below&nbsp;threshold&nbsp;and&nbsp;notified&nbsp;flag&nbsp;set<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Action:&nbsp;reset&nbsp;notified&nbsp;flag<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(domoticz.devices(IDX_STROMVERBRAUCH).WhActual&nbsp;<&nbsp;TH_STROMVERBRAUCH)&nbsp;and&nbsp;(domoticz.data.notified&nbsp;==&nbsp;1)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.data.notified&nbsp;=&nbsp;0<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Check&nbsp;if&nbsp;above&nbsp;threshold&nbsp;and&nbsp;notified&nbsp;flag&nbsp;not&nbsp;set<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Action:&nbsp;set&nbsp;notified&nbsp;flag&nbsp;anf&nbsp;alert&nbsp;message<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(domoticz.devices(IDX_STROMVERBRAUCH).WhActual&nbsp;>&nbsp;TH_STROMVERBRAUCH)&nbsp;and&nbsp;(domoticz.data.notified&nbsp;==&nbsp;0)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;set&nbsp;notified&nbsp;flag<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.data.notified&nbsp;=&nbsp;1<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;get&nbsp;the&nbsp;time&nbsp;on&nbsp;and&nbsp;log<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;timeon&nbsp;=&nbsp;os.date("*t")<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;('Kaffee&nbsp;Machine&nbsp;an&nbsp;%02d:%02d'):format(timeon.hour,&nbsp;timeon.min)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log(message,&nbsp;domoticz.LOG_INFO)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;calculate&nbsp;the&nbsp;time&nbsp;off&nbsp;=&nbsp;timeon&nbsp;+&nbsp;2&nbsp;hours<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeoff&nbsp;=&nbsp;os.date("*t",&nbsp;os.time()&nbsp;+&nbsp;2*60*60)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;define&nbsp;message&nbsp;to&nbsp;notify&nbsp;the&nbsp;time&nbsp;coffee&nbsp;machine&nbsp;switches&nbsp;off<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;('Kaffee&nbsp;Machine&nbsp;aus&nbsp;%02d:%02d'):format(timeoff.hour,&nbsp;timeoff.min)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;alert&nbsp;message<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_ORANGE,&nbsp;message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log(message,&nbsp;domoticz.LOG_INFO)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>}<BR/></CODE><HR>
<H3>days_to_go_update</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;days_to_go_update.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;days-to-go&nbsp;once&nbsp;per&nbsp;day&nbsp;for&nbsp;virtual&nbsp;devices:&nbsp;idx=29,57,97<BR/>&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;testing,&nbsp;add&nbsp;'every&nbsp;minute'&nbsp;to&nbsp;the&nbsp;timer&nbsp;and&nbsp;check&nbsp;the&nbsp;log&nbsp;file.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Timer<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20190213<BR/>]]--<BR/><BR/>--&nbsp;External&nbsp;modules<BR/>local&nbsp;utils&nbsp;=&nbsp;require('utils')<BR/><BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_DAYSPHASE&nbsp;=&nbsp;29;&nbsp;<BR/>local&nbsp;IDX_DAYSLOUIS&nbsp;=&nbsp;57;<BR/>local&nbsp;IDX_DAYSFELIX&nbsp;=&nbsp;97;&nbsp;<BR/>local&nbsp;IDX_DAYSLANZAROTE&nbsp;=&nbsp;142;&nbsp;<BR/><BR/>--&nbsp;Event<BR/>return&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'at&nbsp;01:00'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;'every&nbsp;minute'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;},<BR/>&nbsp;&nbsp;&nbsp;&nbsp;execute&nbsp;=&nbsp;function(domoticz,&nbsp;timer)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;domoticz.log('Event&nbsp;triggerd&nbsp;by&nbsp;rule:&nbsp;'&nbsp;..&nbsp;timer.trigger)<BR/><BR/>		--&nbsp;For&nbsp;each&nbsp;days-to-go&nbsp;device:<BR/>		--&nbsp;calculate&nbsp;the&nbsp;days&nbsp;difference&nbsp;between&nbsp;target&nbsp;date&nbsp;and&nbsp;now,&nbsp;<BR/>		--&nbsp;define&nbsp;the&nbsp;text&nbsp;to&nbsp;display&nbsp;and&nbsp;update&nbsp;the&nbsp;device<BR/><BR/>		--&nbsp;Phase4&nbsp;days&nbsp;left<BR/>		domoticz.devices(IDX_DAYSPHASE).updateText(tostring(utils.datediffnow2(1,9,2021))&nbsp;..&nbsp;'&nbsp;T')<BR/>		--&nbsp;Louis&nbsp;days&nbsp;since&nbsp;birth<BR/>		domoticz.devices(IDX_DAYSLOUIS).updateText(utils.ageyearsdays(7,9,2016))<BR/>		--&nbsp;FELIX&nbsp;days&nbsp;since&nbsp;birth<BR/>		domoticz.devices(IDX_DAYSFELIX).updateText(utils.ageyearsdays(13,2,2019))<BR/>		--&nbsp;Lanzarote&nbsp;Urlaub&nbsp;days&nbsp;till<BR/>		domoticz.devices(IDX_DAYSLANZAROTE).updateText(tostring(utils.datediffnow2(12,3,2019))&nbsp;..&nbsp;'&nbsp;T')<BR/><BR/>end<BR/>}<BR/></CODE><HR>
<H3>electric_usage_update</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;electric_usage_update.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Send,&nbsp;every&nbsp;3&nbsp;minutes,&nbsp;a&nbsp;HTTP&nbsp;Request&nbsp;(GET)&nbsp;to&nbsp;the&nbsp;Raspberry&nbsp;Pi&nbsp;running&nbsp;the&nbsp;volkszaehler.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;volkszaehler&nbsp;resonse&nbsp;is&nbsp;a&nbsp;JSON&nbsp;string.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;the&nbsp;Powerconsumption&nbsp;device&nbsp;(44,&nbsp;VirtualSensors,Stromverbrauch,Usage,Electric,2205.58&nbsp;Watt).<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;Examples<BR/>&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;last&nbsp;5&nbsp;minutes&nbsp;(ensure&nbsp;to&nbsp;replace&nbsp;the&nbsp;space&nbsp;by&nbsp;a&nbsp;+<BR/>&nbsp;&nbsp;&nbsp;&nbsp;requesturl&nbsp;=&nbsp;'http://vz-ip-address/middleware.php/data/958bce60-b342-11e8-b54f-bbec0573e1f4.json?from=5+minutes+ago&to=now'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;now<BR/>&nbsp;&nbsp;&nbsp;&nbsp;requesturl&nbsp;=&nbsp;'http://vz-ip-address/middleware.php/data/958bce60-b342-11e8-b54f-bbec0573e1f4.json?from=now&to=now',<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;Result&nbsp;JSON&nbsp;string<BR/>&nbsp;&nbsp;&nbsp;&nbsp;{"version":"0.3","data":{"tuples":###,"uuid":"958bce60-b342-11e8-b54f-bbec0573e1f4","from":1536243168796,"to":1536243170351,"min":[1536243170351,926.0450147835],"max":[1536243170351,926.0450147835],"average":926.045,"consumption":0.4,"rows":2}}<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Obtain&nbsp;the&nbsp;powerconsumption&nbsp;from&nbsp;key&nbsp;data.average<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;testing,&nbsp;add&nbsp;'every&nbsp;minute'&nbsp;to&nbsp;the&nbsp;timer&nbsp;and&nbsp;check&nbsp;the&nbsp;log&nbsp;file.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Timer<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;201809111<BR/>]]--<BR/><BR/>--&nbsp;External&nbsp;modules:&nbsp;/home/pi/domoticz/scripts/dzVents/scripts<BR/>local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/>&nbsp;<BR/>--&nbsp;The&nbsp;request&nbsp;url&nbsp;uses&nbsp;from=5&nbsp;minutes&nbsp;ago&nbsp;to&nbsp;to=now<BR/>local&nbsp;requesturl&nbsp;=&nbsp;'http://vz-ip-address/middleware.php/data/958bce60-b342-11e8-b54f-bbec0573e1f4.json?from=5+minutes+ago&to=now'<BR/><BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_POWERCONSUMPTION&nbsp;=&nbsp;44<BR/><BR/>return&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;active&nbsp;=&nbsp;true,<BR/>	on&nbsp;=&nbsp;{<BR/>		timer&nbsp;=&nbsp;{<BR/>			'every&nbsp;3&nbsp;minutes'<BR/>			--&nbsp;'every&nbsp;minute'<BR/>		},<BR/>		httpResponses&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'electricusageData'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR/>	},<BR/>	execute&nbsp;=&nbsp;function(domoticz,&nbsp;item)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;if&nbsp;the&nbsp;timer&nbsp;is&nbsp;executed,&nbsp;then&nbsp;place&nbsp;http&nbsp;get&nbsp;request,&nbsp;which&nbsp;result&nbsp;is&nbsp;handled&nbsp;by&nbsp;the&nbsp;callback.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(item.isTimer)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.openURL({<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;requesturl,<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method&nbsp;=&nbsp;'GET',<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback&nbsp;=&nbsp;'electricusageData'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<BR/>		end<BR/>		--&nbsp;callback&nbsp;handling&nbsp;the&nbsp;url&nbsp;get&nbsp;request&nbsp;response<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(item.isHTTPResponse)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;for&nbsp;tests&nbsp;log&nbsp;the&nbsp;data&nbsp;requested&nbsp;(json&nbsp;string)<BR/>			--&nbsp;domoticz.log(item.data)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(item.ok)&nbsp;then&nbsp;--&nbsp;statusCode&nbsp;==&nbsp;2xx<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;parse&nbsp;the&nbsp;json&nbsp;string&nbsp;to&nbsp;get&nbsp;the&nbsp;average&nbsp;from&nbsp;key&nbsp;data.average<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;powerconsumption&nbsp;=&nbsp;tonumber(item.json.data.average)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;the&nbsp;powerconsumption&nbsp;device<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(IDX_POWERCONSUMPTION).updateEnergy(math.floor(powerconsumption))<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log('[INFO]&nbsp;Electric&nbsp;usage&nbsp;updated:&nbsp;'&nbsp;..&nbsp;powerconsumption&nbsp;..&nbsp;'&nbsp;'&nbsp;..&nbsp;tostring(item.statusCode),&nbsp;domoticz.LOG_INFO)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;(item.ok)&nbsp;then&nbsp;--&nbsp;statusCode&nbsp;!=&nbsp;2xx<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;message&nbsp;=&nbsp;'[ERROR]&nbsp;Electric&nbsp;usage:&nbsp;'&nbsp;..&nbsp;tostring(item.statusCode)&nbsp;..&nbsp;'&nbsp;'&nbsp;..&nbsp;msgbox.isnowdatetime(domoticz)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_YELLOW,&nbsp;message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log(message,&nbsp;domoticz.LOG_INFO)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>	end<BR/>}<BR/><BR/></CODE><HR>
<H3>hue_wz_timer</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;hue_wz_timer.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Turn&nbsp;WZ&nbsp;Hue&nbsp;lamps&nbsp;on&nbsp;&&nbsp;off&nbsp;by&nbsp;given&nbsp;time:&nbsp;ON&nbsp;at&nbsp;sunset,&nbsp;OFF&nbsp;at&nbsp;23:00.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;the&nbsp;alert&nbsp;message.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;IMPORTANT:&nbsp;Ensure&nbsp;the&nbsp;timer&nbsp;and&nbsp;the&nbsp;timer&nbsp;trigger&nbsp;are&nbsp;the&nbsp;same.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Timer<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20181128<BR/>]]--<BR/><BR/>--&nbsp;External&nbsp;modules<BR/>local&nbsp;utils&nbsp;=&nbsp;require('utils')<BR/>local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/><BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_HUE_WZABLAGE&nbsp;=&nbsp;111<BR/>local&nbsp;IDX_HUE_WZTV&nbsp;=&nbsp;112<BR/>local&nbsp;IDX_HUE_HAUSTUER&nbsp;=&nbsp;110<BR/><BR/>--&nbsp;Update&nbsp;alert&nbsp;message&nbsp;with&nbsp;alert&nbsp;level&nbsp;green.<BR/>local&nbsp;function&nbsp;setalertmsg(domoticz,&nbsp;state)<BR/>	local&nbsp;message=&nbsp;'Hue&nbsp;Lampen&nbsp;'&nbsp;..&nbsp;state&nbsp;..&nbsp;'&nbsp;'&nbsp;..&nbsp;utils.isnowhhmm(domoticz)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_GREEN,&nbsp;message)<BR/>end<BR/><BR/>local&nbsp;function&nbsp;hueswitchon(domoticz)<BR/>	domoticz.devices(IDX_HUE_WZABLAGE).switchOn()<BR/>&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(IDX_HUE_WZTV).switchOn()<BR/>&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(IDX_HUE_HAUSTUER).switchOn()<BR/>&nbsp;&nbsp;&nbsp;&nbsp;setalertmsg(domoticz,&nbsp;'an')<BR/>end<BR/><BR/>local&nbsp;function&nbsp;hueswitchoff(domoticz)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(IDX_HUE_WZABLAGE).switchOff()<BR/>&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(IDX_HUE_WZTV).switchOff()<BR/>&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(IDX_HUE_HAUSTUER).switchOff()<BR/>&nbsp;&nbsp;&nbsp;&nbsp;setalertmsg(domoticz,&nbsp;'aus')<BR/>end<BR/><BR/>return&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;active&nbsp;=&nbsp;true,<BR/>&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'60&nbsp;minutes&nbsp;before&nbsp;sunset',<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'30&nbsp;minutes&nbsp;before&nbsp;sunset',<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'at&nbsp;23:00',<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'at&nbsp;07:00',<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'at&nbsp;08:00'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR/>&nbsp;&nbsp;&nbsp;&nbsp;},<BR/>&nbsp;&nbsp;&nbsp;&nbsp;execute&nbsp;=&nbsp;function(domoticz,&nbsp;timer)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;in&nbsp;the&nbsp;evening&nbsp;send&nbsp;message&nbsp;hue&nbsp;lights&nbsp;will&nbsp;be&nbsp;switched&nbsp;on<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(timer.trigger&nbsp;==&nbsp;'60&nbsp;minutes&nbsp;before&nbsp;sunset')&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;format&nbsp;date&nbsp;&&nbsp;time&nbsp;see&nbsp;www.lua.org/pil/22.1.html.&nbsp;X&nbsp;=&nbsp;time.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;now=os.time()<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;nowplus30minutes&nbsp;=&nbsp;utils.converttimehhmm(os.date("%X",now+(30*60)))<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	local&nbsp;message=&nbsp;'Hue&nbsp;Lampen&nbsp;gehen&nbsp;an&nbsp;'&nbsp;..&nbsp;nowplus30minutes<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_GREEN,&nbsp;message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;switch&nbsp;the&nbsp;hue&nbsp;lights&nbsp;on&nbsp;&&nbsp;off&nbsp;in&nbsp;the&nbsp;evening<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(timer.trigger&nbsp;==&nbsp;'30&nbsp;minutes&nbsp;before&nbsp;sunset')&nbsp;then&nbsp;hueswitchon(domoticz)&nbsp;end<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(timer.trigger&nbsp;==&nbsp;'at&nbsp;23:00')&nbsp;then&nbsp;hueswitchoff(domoticz)&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;switch&nbsp;the&nbsp;hue&nbsp;lights&nbsp;on&nbsp;&&nbsp;off&nbsp;in&nbsp;the&nbsp;morning<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;NOT&nbsp;USED<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;if&nbsp;(timer.trigger&nbsp;==&nbsp;'at&nbsp;07:00')&nbsp;then&nbsp;hueswitchon(domoticz)&nbsp;end<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;if&nbsp;(timer.trigger&nbsp;==&nbsp;'at&nbsp;08:00')&nbsp;then&nbsp;hueswitchoff(domoticz)&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>}<BR/></CODE><HR>
<H3>luftdruck_update</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;luftdruck_update.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;BMP280&nbsp;device&nbsp;(idx=115)&nbsp;has&nbsp;changed,&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;update&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Virtual&nbsp;Sensor&nbsp;Barometer&nbsp;named&nbsp;Luftdruck&nbsp;(idx=116)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;print(device.dump())&nbsp;ONLY&nbsp;ONCE&nbsp;to&nbsp;get&nbsp;the&nbsp;properties.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Device<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20180911<BR/>]]--<BR/><BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_BMP280&nbsp;=&nbsp;115;<BR/>local&nbsp;IDX_LUFTDRUCK&nbsp;=&nbsp;116;<BR/><BR/>--&nbsp;Event&nbsp;handling&nbsp;changes&nbsp;of&nbsp;the&nbsp;BMP280&nbsp;device<BR/>return&nbsp;{<BR/>	on&nbsp;=&nbsp;{<BR/>		devices&nbsp;=&nbsp;{<BR/>			IDX_BMP280<BR/>		}<BR/>	},<BR/>	execute&nbsp;=&nbsp;function(domoticz,&nbsp;device)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;print(device.dump())<BR/><BR/>		--&nbsp;domoticz.log('Device&nbsp;'&nbsp;..&nbsp;device.name&nbsp;..&nbsp;'&nbsp;changed&nbsp;',&nbsp;domoticz.LOG_INFO)<BR/>		domoticz.log('Barometer:&nbsp;'&nbsp;..&nbsp;device.barometer&nbsp;..&nbsp;'/'&nbsp;..&nbsp;device.forecast&nbsp;..&nbsp;'/'&nbsp;..&nbsp;device.forecastString,&nbsp;domoticz.LOG_INFO)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Round&nbsp;the&nbsp;pressure<BR/>		pressure&nbsp;=&nbsp;math.floor(device.barometer)<BR/><BR/>		--&nbsp;Forecast&nbsp;from&nbsp;the&nbsp;BMP&nbsp;device&nbsp;to&nbsp;the&nbsp;Barometer&nbsp;device<BR/>		--&nbsp;See&nbsp;source&nbsp;code&nbsp;RFXNames.cpp,&nbsp;BMP_Forecast_Desc<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Map&nbsp;the&nbsp;BMP_Forecase_Desc&nbsp;string&nbsp;to&nbsp;dzEvents&nbsp;Forecast&nbsp;value:<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;domoticz.BARO_STABLE,&nbsp;BARO_SUNNY,&nbsp;BARO_CLOUDY,&nbsp;BARO_UNSTABLE,&nbsp;BARO_THUNDERSTORM<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forecast&nbsp;=&nbsp;-1<BR/>		if&nbsp;(device.forecastString&nbsp;==&nbsp;'Stable')&nbsp;then&nbsp;forecast&nbsp;=&nbsp;domoticz.BARO_STABLE&nbsp;end<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.forecastString&nbsp;==&nbsp;'Sunny')&nbsp;then&nbsp;forecast&nbsp;=&nbsp;domoticz.BARO_SUNNY&nbsp;end<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.forecastString&nbsp;==&nbsp;'Cloudy')&nbsp;then&nbsp;forecast&nbsp;=&nbsp;domoticz.BARO_CLOUDY&nbsp;end<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.forecastString&nbsp;==&nbsp;'Unstable')&nbsp;then&nbsp;forecast&nbsp;=&nbsp;domoticz.BARO_UNSTABLE&nbsp;end<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.forecastString&nbsp;==&nbsp;'Thunderstorm')&nbsp;then&nbsp;forecast&nbsp;=&nbsp;domoticz.BARO_THUNDERSTORM&nbsp;end<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.forecastString&nbsp;==&nbsp;'Unknown')&nbsp;then&nbsp;forecast&nbsp;=&nbsp;domoticz.BARO_STABLE&nbsp;end<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.forecastString&nbsp;==&nbsp;'Cloudy/Rain')&nbsp;then&nbsp;forecast&nbsp;=&nbsp;domoticz.BARO_CLOUDY&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Update&nbsp;the&nbsp;virtual&nbsp;sensor&nbsp;Luftdruck<BR/>		domoticz.devices(IDX_LUFTDRUCK).updateBarometer(pressure,&nbsp;forecast)<BR/>	end<BR/>}</CODE><HR>
<H3>rpi_monitor</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;rpi_monitor.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Monitor&nbsp;the&nbsp;Raspberry&nbsp;Pi&nbsp;and&nbsp;notify,&nbsp;via&nbsp;alert&nbsp;message,&nbsp;in&nbsp;case&nbsp;threshold&nbsp;reached&nbsp;or&nbsp;exceeded.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Device<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20180910<BR/>]]--<BR/><BR/>--&nbsp;External&nbsp;modules<BR/>local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/>local&nbsp;utils&nbsp;=&nbsp;require('utils')<BR/>&nbsp;<BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_RPI_MEMORYUSAGE&nbsp;=&nbsp;1<BR/>local&nbsp;IDX_RPI_HDDUSAGE&nbsp;=&nbsp;3<BR/>local&nbsp;IDX_RPI_TEMPERATURE&nbsp;=&nbsp;4<BR/><BR/>--&nbsp;Thresholds&nbsp;are&nbsp;set&nbsp;via&nbsp;user&nbsp;variables,&nbsp;i.e.&nbsp;TH_RPI_MEMORYUSAGE<BR/><BR/>--&nbsp;Check&nbsp;if&nbsp;the&nbsp;device&nbsp;state&nbsp;exceeds&nbsp;threshold&nbsp;and&nbsp;update&nbsp;control&nbsp;message<BR/>local&nbsp;function&nbsp;checkthreshold(domoticz,&nbsp;device,&nbsp;threshold)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tonumber(device.state)&nbsp;>&nbsp;threshold)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;message&nbsp;=&nbsp;device.name&nbsp;..&nbsp;'&nbsp;above&nbsp;threshold&nbsp;'&nbsp;..&nbsp;threshold&nbsp;..&nbsp;'&nbsp;('&nbsp;..&nbsp;device.state&nbsp;..&nbsp;')&nbsp;'&nbsp;..&nbsp;utils.isnowhhmm(domoticz)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_RED,&nbsp;message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>end<BR/><BR/>return&nbsp;{<BR/>	on&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Devices&nbsp;idx&nbsp;to&nbsp;monitor<BR/>		devices&nbsp;=&nbsp;{<BR/>			IDX_RPI_MEMORYUSAGE,<BR/>			IDX_RPI_HDDUSAGE,<BR/>			IDX_RPI_TEMPERATURE<BR/>		}<BR/>	},<BR/>	execute&nbsp;=&nbsp;function(domoticz,&nbsp;device)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Log&nbsp;the&nbsp;change&nbsp;for&nbsp;testing<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;domoticz.log('RPi&nbsp;Monitor&nbsp;Device&nbsp;'&nbsp;..&nbsp;device.name&nbsp;..&nbsp;','&nbsp;..&nbsp;device.idx&nbsp;..&nbsp;'&nbsp;was&nbsp;changed:'&nbsp;..&nbsp;device.state&nbsp;..&nbsp;'/'&nbsp;..&nbsp;device.rawData[1],&nbsp;domoticz.LOG_INFO)<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;select&nbsp;the&nbsp;device<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;RPi&nbsp;Memory&nbsp;Usage<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.idx&nbsp;==&nbsp;IDX_RPI_MEMORYUSAGE)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkthreshold(domoticz,&nbsp;device,&nbsp;domoticz.variables('TH_RPI_MEMORYUSAGE').value)<BR/>		end&nbsp;&nbsp;&nbsp;&nbsp;<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;RPi&nbsp;HDD&nbsp;Usage<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.idx&nbsp;==&nbsp;IDX_RPI_HDDUSAGE)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkthreshold(domoticz,&nbsp;device,&nbsp;domoticz.variables('TH_RPI_HDDUSAGE').value)<BR/>		end&nbsp;&nbsp;&nbsp;&nbsp;<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;RPi&nbsp;Temperature<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(device.idx&nbsp;==&nbsp;IDX_RPI_TEMPERATURE)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkthreshold(domoticz,&nbsp;device,&nbsp;domoticz.variables('TH_RPI_TEMPERATURE').value)<BR/>		end&nbsp;&nbsp;&nbsp;&nbsp;<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>}<BR/></CODE><HR>
<H3>stock_monitor</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;monitor_stocks.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Monitor&nbsp;if&nbsp;a&nbsp;stock&nbsp;has&nbsp;reached&nbsp;its&nbsp;threshold&nbsp;and&nbsp;send&nbsp;out&nbsp;a&nbsp;notification.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Device<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20190215<BR/>]]--<BR/><BR/>--&nbsp;External&nbsp;modules:<BR/>local&nbsp;utils&nbsp;=&nbsp;require('utils')<BR/>local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/><BR/>--&nbsp;Stock&nbsp;RDS&nbsp;-&nbsp;idx&nbsp;device,&nbsp;idx&nbsp;uservariable&nbsp;threshold,&nbsp;idx&nbsp;uservariable&nbsp;thresholdnotified<BR/>local&nbsp;IDX_STOCK_RDS&nbsp;=&nbsp;152<BR/>local&nbsp;IDX_TH_STOCK_RDS&nbsp;=&nbsp;8<BR/>local&nbsp;IDX_TH_STOCK_RDS_NOTIFIED&nbsp;=&nbsp;9<BR/><BR/>--&nbsp;temp&nbsp;var&nbsp;for&nbsp;the&nbsp;threshold&nbsp;value<BR/>local&nbsp;thresholdvalue<BR/>--&nbsp;flag&nbsp;to&nbsp;check&nbsp;if&nbsp;notified,&nbsp;to&nbsp;avoid&nbsp;notifying&nbsp;for&nbsp;every&nbsp;change&nbsp;above&nbsp;threshold<BR/>local&nbsp;thresholdnotified&nbsp;=&nbsp;0<BR/>--&nbsp;message<BR/>local&nbsp;message<BR/><BR/>return&nbsp;{<BR/>	on&nbsp;=&nbsp;{<BR/>		devices&nbsp;=&nbsp;{<BR/>			IDX_STOCK_RDS<BR/>		}<BR/>	},<BR/>	execute&nbsp;=&nbsp;function(domoticz,&nbsp;device)<BR/>&nbsp;		domoticz.log('Device&nbsp;'&nbsp;..&nbsp;device.name&nbsp;..&nbsp;'&nbsp;was&nbsp;changed&nbsp;&nbsp;to&nbsp;'..&nbsp;device.state,&nbsp;domoticz.LOG_INFO)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;select&nbsp;the&nbsp;device&nbsp;to&nbsp;obtain&nbsp;the&nbsp;thresholdvalue<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;device.idx&nbsp;==&nbsp;IDX_STOCK_RDS&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thresholdvalue&nbsp;=&nbsp;domoticz.variables(IDX_TH_STOCK_RDS).value<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thresholdnotified&nbsp;=&nbsp;domoticz.variables(IDX_TH_STOCK_RDS_NOTIFIED).value<BR/>&nbsp;		&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log('Device&nbsp;'&nbsp;..&nbsp;device.name&nbsp;..&nbsp;':&nbsp;'..&nbsp;tostring(thresholdvalue)&nbsp;..&nbsp;',&nbsp;'&nbsp;..&nbsp;tostring(thresholdnotified),&nbsp;domoticz.LOG_INFO)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;add&nbsp;more&nbsp;devices<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;if&nbsp;notified&nbsp;flag&nbsp;is&nbsp;set&nbsp;(>&nbsp;-1)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(thresholdnotified&nbsp;~=&nbsp;-1)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;reset&nbsp;the&nbsp;message<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;''<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;if&nbsp;the&nbsp;device&nbsp;value&nbsp;equals&nbsp;or&nbsp;geater&nbsp;threshold&nbsp;(user_variable)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;log&nbsp;and&nbsp;notify&nbsp;accordingly<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tonumber(device.state)&nbsp;>=&nbsp;thresholdvalue)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;alert&nbsp;message,only&nbsp;if&nbsp;notifiedflag&nbsp;=&nbsp;0&nbsp;to&nbsp;avoid&nbsp;duplication<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;thresholdnotified&nbsp;==&nbsp;0&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thresholdnotified&nbsp;=&nbsp;1<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;device.name&nbsp;..&nbsp;'&nbsp;'&nbsp;..&nbsp;tonumber(device.state)&nbsp;..&nbsp;'&nbsp;reached&nbsp;threshold&nbsp;'&nbsp;..&nbsp;&nbsp;tostring(thresholdvalue)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;DEBUG&nbsp;domoticz.log(message,&nbsp;domoticz.LOG_INFO)&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;below&nbsp;threshold,then&nbsp;reset&nbsp;flag&nbsp;and&nbsp;set&nbsp;message<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tonumber(device.state)&nbsp;<&nbsp;thresholdvalue)&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;thresholdnotified&nbsp;==&nbsp;1&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;device.name&nbsp;..&nbsp;'&nbsp;'&nbsp;..&nbsp;tonumber(device.state)&nbsp;..&nbsp;'&nbsp;below&nbsp;threshold&nbsp;'&nbsp;..&nbsp;&nbsp;tostring(thresholdvalue)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thresholdnotified&nbsp;=&nbsp;0<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;DEBUG&nbsp;domoticz.log(message,&nbsp;domoticz.LOG_INFO)&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;if&nbsp;the&nbsp;message&nbsp;is&nbsp;empty<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(message&nbsp;~=&nbsp;'')&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;the&nbsp;user&nbsp;variable<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.variables(IDX_TH_STOCK_RDS_NOTIFIED).set(thresholdnotified)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;write&nbsp;to&nbsp;log<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log(message,&nbsp;domoticz.LOG_INFO)&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;set&nbsp;the&nbsp;alert&nbsp;message<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_ORANGE,&nbsp;message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;and&nbsp;notification<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;domoticz.notify(message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>	end<BR/>}</CODE><HR>
<H3>waste_calendar_update</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;waste_calendar_update.lua<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Read&nbsp;a&nbsp;csv&nbsp;file&nbsp;with&nbsp;wastecalendar&nbsp;dates&nbsp;per&nbsp;device.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;the&nbsp;device&nbsp;text&nbsp;with&nbsp;the&nbsp;date&nbsp;if&nbsp;the&nbsp;date&nbsp;is&nbsp;within&nbsp;interval&nbsp;specified.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;wastecalender&nbsp;file&nbsp;"wastecal.csv"&nbsp;is&nbsp;located&nbsp;in&nbsp;the&nbsp;dzVents&nbsp;scripts&nbsp;folder.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;entry&nbsp;csv&nbsp;file:&nbsp;idx,interval,date1,dateN.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Timer<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20180930<BR/>]]--<BR/><BR/>--&nbsp;External&nbsp;modules:&nbsp;/home/pi/domoticz/scripts/dzVents/scripts<BR/>local&nbsp;utils&nbsp;=&nbsp;require('utils')<BR/>local&nbsp;msgbox&nbsp;=&nbsp;require('msgbox')<BR/><BR/>--&nbsp;threshold&nbsp;in&nbsp;days&nbsp;to&nbsp;notify<BR/>--&nbsp;if&nbsp;the&nbsp;difference&nbsp;of&nbsp;the&nbsp;current&nbsp;day&nbsp;to&nbsp;a&nbsp;wastecalendarday&nbsp;equals&nbsp;threshold<BR/>--&nbsp;then&nbsp;notify<BR/>local&nbsp;TH_WASTECAL&nbsp;=&nbsp;1<BR/><BR/>--&nbsp;Helpers<BR/>function&nbsp;string:split(&nbsp;inSplitPattern,&nbsp;outResults&nbsp;)<BR/>&nbsp;&nbsp;if&nbsp;not&nbsp;outResults&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;outResults&nbsp;=&nbsp;{&nbsp;}<BR/>&nbsp;&nbsp;end<BR/>&nbsp;&nbsp;local&nbsp;theStart&nbsp;=&nbsp;1<BR/>&nbsp;&nbsp;local&nbsp;theSplitStart,&nbsp;theSplitEnd&nbsp;=&nbsp;string.find(&nbsp;self,&nbsp;inSplitPattern,&nbsp;theStart&nbsp;)<BR/>&nbsp;&nbsp;while&nbsp;theSplitStart&nbsp;do<BR/>&nbsp;&nbsp;&nbsp;&nbsp;table.insert(&nbsp;outResults,&nbsp;string.sub(&nbsp;self,&nbsp;theStart,&nbsp;theSplitStart-1&nbsp;)&nbsp;)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;theStart&nbsp;=&nbsp;theSplitEnd&nbsp;+&nbsp;1<BR/>&nbsp;&nbsp;&nbsp;&nbsp;theSplitStart,&nbsp;theSplitEnd&nbsp;=&nbsp;string.find(&nbsp;self,&nbsp;inSplitPattern,&nbsp;theStart&nbsp;)<BR/>&nbsp;&nbsp;end<BR/>&nbsp;&nbsp;table.insert(&nbsp;outResults,&nbsp;string.sub(&nbsp;self,&nbsp;theStart&nbsp;)&nbsp;)<BR/>&nbsp;&nbsp;return&nbsp;outResults<BR/>end<BR/><BR/>--&nbsp;the&nbsp;wastecalendar&nbsp;file&nbsp;is&nbsp;updated&nbsp;once&nbsp;per&nbsp;year<BR/>local&nbsp;wastecalfile&nbsp;=&nbsp;'/home/pi/domoticz/scripts/dzVents/scripts/wastecal.csv'<BR/>local&nbsp;sep&nbsp;=&nbsp;","<BR/><BR/>--&nbsp;read&nbsp;the&nbsp;csv&nbsp;file<BR/>function&nbsp;readandupdate(domoticz)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;read&nbsp;the&nbsp;file&nbsp;line&nbsp;by&nbsp;line.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;each&nbsp;line&nbsp;contains&nbsp;an&nbsp;array&nbsp;with&nbsp;device[1],&nbsp;wasteinterval[2],&nbsp;dates[2...]<BR/>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;line&nbsp;in&nbsp;io.lines(wastecalfile)&nbsp;do<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;split&nbsp;the&nbsp;line&nbsp;by&nbsp;,&nbsp;and&nbsp;assign&nbsp;to&nbsp;a&nbsp;table<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;wastetable&nbsp;=&nbsp;line:split(sep)<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;idx&nbsp;=&nbsp;tonumber(wastetable[1])<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;interval&nbsp;=&nbsp;tonumber(wastetable[2])<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;flag&nbsp;to&nbsp;check&nbsp;if&nbsp;a&nbsp;wastedate&nbsp;has&nbsp;been&nbsp;found<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;datefound&nbsp;=&nbsp;0<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;the&nbsp;dates,&nbsp;start&nbsp;at&nbsp;3&nbsp;because&nbsp;1=idx,&nbsp;2=interval&nbsp;and&nbsp;number&nbsp;of&nbsp;table&nbsp;entries<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;=&nbsp;3,&nbsp;#wastetable&nbsp;do<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;get&nbsp;the&nbsp;wastedate&nbsp;array&nbsp;entry<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;wastedate&nbsp;=&nbsp;wastetable[i]<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;split&nbsp;the&nbsp;wastedate&nbsp;into&nbsp;an&nbsp;array&nbsp;with&nbsp;3&nbsp;entries&nbsp;day,&nbsp;month,&nbsp;year<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;wastedatesplit&nbsp;=&nbsp;wastedate:split("-")<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;calculate&nbsp;the&nbsp;daysdiff&nbsp;between&nbsp;now&nbsp;and&nbsp;the&nbsp;wastedate<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;daysdiff&nbsp;=&nbsp;utils.datediffnow(wastedatesplit[1],&nbsp;wastedatesplit[2],&nbsp;wastedatesplit[3])<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;month&nbsp;=&nbsp;tonumber(wastedatesplit[2])<BR/><BR/>		&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;if&nbsp;daysdiff&nbsp;within&nbsp;interval<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;if&nbsp;daysdiff&nbsp;>=&nbsp;0&nbsp;and&nbsp;daysdiff&nbsp;<&nbsp;interval&nbsp;then<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;daysdiff&nbsp;>=&nbsp;0&nbsp;and&nbsp;datefound&nbsp;==&nbsp;0&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;datefound&nbsp;=&nbsp;1<BR/>			&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(domoticz.devices(idx).name&nbsp;..&nbsp;'('&nbsp;..&nbsp;idx&nbsp;..&nbsp;')='&nbsp;..&nbsp;wastedate&nbsp;..&nbsp;',&nbsp;days='&nbsp;..&nbsp;daysdiff&nbsp;..&nbsp;',&nbsp;interval='&nbsp;..&nbsp;interval)<BR/><BR/>			&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;the&nbsp;device&nbsp;text&nbsp;with&nbsp;the&nbsp;new&nbsp;date<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(idx).updateText(wastedate)<BR/>			<BR/>			&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;number&nbsp;of&nbsp;days&nbsp;left&nbsp;compared&nbsp;to&nbsp;the&nbsp;threshold<BR/>			&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;i.e.&nbsp;if&nbsp;1&nbsp;day&nbsp;left,&nbsp;then&nbsp;notify&nbsp;using&nbsp;device&nbsp;name&nbsp;&&nbsp;text.<BR/>			&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;the&nbsp;device&nbsp;text&nbsp;contains&nbsp;the&nbsp;date<BR/>			&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;NOT&nbsp;USED&nbsp;=&nbsp;handled&nbsp;by&nbsp;the&nbsp;dzVents&nbsp;script&nbsp;waste_calendar_notifier<BR/>			&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;daysdiff&nbsp;==&nbsp;TH_WASTECAL&nbsp;then<BR/>				&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;print&nbsp;('Device&nbsp;'&nbsp;..&nbsp;idx&nbsp;..&nbsp;'&nbsp;notifying...')<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;'[ACHTUNG]&nbsp;'&nbsp;..&nbsp;domoticz.devices(idx).name&nbsp;..&nbsp;'&nbsp;'&nbsp;..&nbsp;domoticz.devices(idx).text<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;alert&nbsp;message<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;msgbox.alertmsg(domoticz,&nbsp;domoticz.ALERTLEVEL_RED,&nbsp;message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.log(message,&nbsp;domoticz.LOG_INFO)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.notify(message)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;		&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;if&nbsp;for&nbsp;the&nbsp;last&nbsp;entry&nbsp;daysdiff&nbsp;less&nbsp;0,&nbsp;then&nbsp;no&nbsp;new&nbsp;date&nbsp;available<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;this&nbsp;is&nbsp;used&nbsp;f.e.&nbsp;for&nbsp;hohenfelde&nbsp;as&nbsp;last&nbsp;wastedate&nbsp;is&nbsp;sep&nbsp;or&nbsp;oct<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;==&nbsp;#wastetable&nbsp;and&nbsp;daysdiff&nbsp;<&nbsp;0&nbsp;then<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;datefound&nbsp;=&nbsp;1<BR/>			&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(idx&nbsp;..&nbsp;'='&nbsp;..&nbsp;wastedate&nbsp;..&nbsp;',&nbsp;days='&nbsp;..&nbsp;daysdiff&nbsp;..&nbsp;',&nbsp;interval='&nbsp;..&nbsp;interval&nbsp;..&nbsp;',&nbsp;KEIN&nbsp;TERMIN')<BR/><BR/>			&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;update&nbsp;the&nbsp;device&nbsp;text&nbsp;with&nbsp;the&nbsp;info&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;date&nbsp;(yet)&nbsp;available<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(idx).updateText('Kein&nbsp;neuer&nbsp;Termin')<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;check&nbsp;if&nbsp;a&nbsp;wastedate&nbsp;has&nbsp;been&nbsp;found,&nbsp;if&nbsp;not&nbsp;then&nbsp;set&nbsp;Kein&nbsp;termin&nbsp;message<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;datefound&nbsp;==&nbsp;0&nbsp;then<BR/>		&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(idx&nbsp;..&nbsp;'='&nbsp;..&nbsp;'KEIN&nbsp;TERMIN')<BR/>			--&nbsp;update&nbsp;the&nbsp;device&nbsp;text&nbsp;with&nbsp;the&nbsp;info&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;date&nbsp;(yet)&nbsp;available<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domoticz.devices(idx).updateText('Kein&nbsp;neuer&nbsp;Termin')<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;JUST&nbsp;SOME&nbsp;LEARNERS<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;print&nbsp;the&nbsp;content<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;for&nbsp;i&nbsp;=&nbsp;1,&nbsp;#wastetable&nbsp;do<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;	print(&nbsp;wastetable[i]&nbsp;)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;	--&nbsp;end<BR/>	<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;print&nbsp;device&nbsp;idx&nbsp;and&nbsp;length&nbsp;of&nbsp;the&nbsp;csv&nbsp;string<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;print&nbsp;(wastetable[1]&nbsp;..&nbsp;"Length:"&nbsp;..&nbsp;#wastetable)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;end<BR/>end<BR/><BR/>return&nbsp;{<BR/>	on&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;=&nbsp;{<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;for&nbsp;tests&nbsp;use&nbsp;every&nbsp;minute<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;'every&nbsp;minute',<BR/>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'at&nbsp;00:30'<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR/>&nbsp;&nbsp;&nbsp;&nbsp;},<BR/>	execute&nbsp;=&nbsp;function(domoticz)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readandupdate(domoticz)<BR/>	end<BR/>}<BR/></CODE><HR>
<H3>wind_update</H3>

<CODE>--[[<BR/>&nbsp;&nbsp;&nbsp;&nbsp;wind_update.lua<BR/>	If&nbsp;the&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;device&nbsp;Windmesser&nbsp;(idx=28)&nbsp;changes,&nbsp;<BR/>	update&nbsp;the&nbsp;value&nbsp;(Wind&nbsp;direction&nbsp;&&nbsp;speed)&nbsp;of&nbsp;<BR/>	the&nbsp;Virtual&nbsp;Sensor&nbsp;Wind&nbsp;named&nbsp;Wind&nbsp;(ix=117)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;print(device.dump())&nbsp;ONLY&nbsp;ONCE&nbsp;to&nbsp;get&nbsp;the&nbsp;properties.<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Project:&nbsp;atHome<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Interpreter:&nbsp;dzVents,&nbsp;Device<BR/>&nbsp;&nbsp;&nbsp;&nbsp;See:&nbsp;athome.pdf<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Robert&nbsp;W.B.&nbsp;Linn<BR/>&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;20180910<BR/>]]--<BR/><BR/>--&nbsp;Idx&nbsp;of&nbsp;the&nbsp;devices<BR/>local&nbsp;IDX_WINDMESSER&nbsp;=&nbsp;28;<BR/>local&nbsp;IDX_WIND&nbsp;=&nbsp;117;<BR/><BR/>--&nbsp;Event&nbsp;handling&nbsp;changes&nbsp;of&nbsp;the&nbsp;Windmesser&nbsp;device<BR/>return&nbsp;{<BR/>	on&nbsp;=&nbsp;{<BR/>		devices&nbsp;=&nbsp;{<BR/>			IDX_WINDMESSER<BR/>		}<BR/>	},<BR/>	execute&nbsp;=&nbsp;function(domoticz,&nbsp;device)<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;print(device.dump())<BR/>		--&nbsp;domoticz.log('Device&nbsp;'&nbsp;..&nbsp;device.name&nbsp;..&nbsp;'&nbsp;changed&nbsp;',&nbsp;domoticz.LOG_INFO)<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bearing&nbsp;=&nbsp;device.direction<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction&nbsp;=&nbsp;device.directionString<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;speed&nbsp;=&nbsp;device.speed<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gust&nbsp;=&nbsp;device.gust<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temperature&nbsp;=&nbsp;device.temperature<BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chill&nbsp;=&nbsp;device.chill<BR/><BR/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Update&nbsp;the&nbsp;virtual&nbsp;sensor&nbsp;Luftdruck<BR/>		domoticz.devices(IDX_WIND).updateWind(bearing,&nbsp;direction,&nbsp;speed,&nbsp;gust,&nbsp;temperature,&nbsp;chill)<BR/>	end<BR/>}<BR/></CODE><HR>
</body></html>

